## Анализ будущей архитектуры системы

### Функционал приложения
Система "умного дома" (SH), организующая управление отоплением в доме. Система работает по SaaS: пользователь сам настраивает
необходимые модули и подключает их к системе.

1) Пользователь сам выбирает модули и устройства и подключает их в своем доме, далее конфигурирует их через 
web-interface системы SH.
2) Пользователь может просматривать данные с датчиков устройств и отдавать команды через web-interface системы SH (например,
открыть/закрыть ворота, включить/выключить свет в доме)
3) Система умеет поддерживать температуру в доме в заданном значении, а также иные не сложные скрипты.

### Архитектура приложения
- **Язык программирования:** Java, Golang
- **База данных:** PostgreSQL, MonogDB
- **Архитектура:** Микросервисная
- **Взаимодействие:** Синхронное и Асинхронное
- **Масштабируемость:** Путем добавления реплик нужных микросервисов/worker'ов.
- **Развертывание:** K8s: Можно развертывать сервисы независимо Simple/Rolling/Canary update 

 #### Сильные стороны текущей архитектуры:
- Асинхронное взаимодействие, не требующее ожидания всех компонентов цепочки. Например, команду модулю SmartHome мы
отправляем синхронно ("открой ворота" или "включи кондиционер"). А результат работы устройства собираем уже
async через телеметрию, которая сервисом телеметрии публикуется в databus, а оттуда уже подтягивается нужным сервисом
например notification service, который, в свою очередь, отправляет push на устройство пользователя).
- Легкое горизонтальное масштабирование
- Изоляция бизнес логики в сервисы

#### Слабые стороны текущей архитектуры:
- Сложность поддержки/развертывания системы (DevOps)

### Основные микросервисы и их взаимодействие

#### Auth
Отвечает за проверку/выдачу токенов авторизации пользователям системы

#### UserProfile
Отвечает за создание/редактирование профилей пользователей системы

#### DeviceManager

Добавление/удаление/изменение статуса устройства, конфигурация устройства, отправка команд на устройства пользователей

#### Telemetry

Сбор телеметрии устройств (показатели, текущее состояние).

#### Монолит

В монолите продолжает работать модуль поддержания заданной температуры в домах пользователей (вычитывая телеметрию из kafka), 
до того момента, пока функционал не переедет в какой-нибудь микросервис работы с пользовательскими сценариями.


#### Взаимодействие сервисов в системе (основные операции)

- [add new device](sequence_diagram/add_new_device.puml)
- [get device info](sequence_diagram/get_device_info.puml)
- [send command to device](sequence_diagram/send_command.puml)
- [send device telemetry](sequence_diagram/send_device_telemetry.puml)
- [get_telemetry_data](sequence_diagram/get_telemetry_data.puml)

### C4-диаграмма приложения
- [Context layer](Context.puml)
- [Container layer](Container.puml)
- [Component layer](Component.puml)
- [Code layer](Code.puml)
- [ER-diagram](ER-diagram.puml) Тут только взаимодействие основных компонентов




